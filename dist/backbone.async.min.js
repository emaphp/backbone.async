!function(a,b){"function"==typeof define&&define.amd?define(["backbone","underscore"],function(c,d){return b(a,c,d,a.Promise)}):"undefined"!=typeof exports?module.exports=b(a,require("backbone"),require("underscore"),require("promise")):b(a,a.Backbone,a._,a.Promise)}(this,function(a,b,c,d){var e=function(a,b,c){return function(d,e,f){a&&a.apply(d,arguments);var g={response:e,options:f};g[c.collection?"collection":"model"]=d,b(g),"undefined"!=typeof f.silent&&f.silent||d.trigger("after:"+c.method,g,c.success)}},f=function(a,b,d,e){var f,g;return"save"===a?null===b||"object"==typeof b?(f=b,g=d):b&&((f={})[b]=d,g=e):g=b,g=g?c.extend({},g):{},{attrs:f,options:g}},g=function(a){return function(g,h){return g[h]=function(g,i,j){var k=this,l=f(h,g,i,j),m=l.options,n=l.attrs,o=m.success,p=m.error,q={method:h,collection:a===b.Collection.prototype};return new d(function(b,d){m.success=e(o,b,c.extend({success:!0},q)),m.error=e(p,d,c.extend({success:!1},q)),q.collection?("undefined"!=typeof m.silent&&m.silent||k.trigger("before:"+h,{collection:k,options:m}),a[h].call(k,m)):("undefined"!=typeof m.silent&&m.silent||k.trigger("before:"+h,"save"===h?{model:k,options:m,attrs:n}:{model:k,options:m}),a[h].apply(k,"save"===h?[n,m]:[m]))})},g}},h=function(a,b){return b.reduce(g(a.prototype),{})},i=b.Async=b.Async||{};return i.VERSION="0.3.0",i.Model=b.Model.extend(h(b.Model,["fetch","save","destroy"])),i.Collection=b.Collection.extend(h(b.Collection,["fetch"])),i});